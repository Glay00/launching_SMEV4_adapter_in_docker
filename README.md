# Задание 2: Запуск СМЭВ 4 адаптера в Docker

## p.s Файл с выполненным заданием слишком большой, поэтому необходимо скачать [архив с Google drive](https://drive.google.com/file/d/1kIH7Q5tYJcmv__BaGbDpW8dkDlAwKJME/view?usp=sharing) (см. примечание).

### 1. Ознакомиться с документацией Агента ПОДД (СМЭВ 4 Адаптер)

- Ознакомился с документацией;
- Создал тестовую организацию ЛК УВ;
- Создал ИС в тестовой среде ЛК УВ;
- Сформировал сертификаты для дальнейшего подключения;
- Ознакомился с инструкцией для развёртывания в docker.

### 2. Разверуть  образ docker контейнера для Агента ПОДД


- Развернул docker-image (локально) командой ```./install.sh```.
![2024-02-25 19 52 01](https://github.com/Glay00/second_task_to-increase/assets/96641789/1736e73a-483e-4747-83a1-0ca7503a6360)

- Настроил конфигрурационный файл application.yml.
![Снимок экрана 2024-02-25 в 13 43 27](https://github.com/Glay00/second_task_to-increase/assets/96641789/8d367bea-733d-495a-99c3-610096ea0a75)

- Запустил контейнер-докер (локально) командой ```.run.sh```.
<img width="1384" alt="Снимок экрана 2024-02-25 в 15 25 52" src="https://github.com/Glay00/second_task_to-increase/assets/96641789/031bb391-aaed-4c59-bb5b-fb9b956f3f53">

### 3. Получить лог-файл Агента ПОДД

- сформировал log-файл командой ```./log.sh```

см. ```log-20240225-114110.txt``` в корне [проекта](https://drive.google.com/file/d/1kIH7Q5tYJcmv__BaGbDpW8dkDlAwKJME/view?usp=sharing) скаченного с Google drive.


- Для удобства сборки был добавлен docker-compose:
  
  Собрать контейнер командой ```docker-compose build```
  
  Запустить контейнер ```docker-compose up```

___
  
### 4. Описать схему обмена сведениями в СМЭВ 4

СМЭВ 4 - это система, предназначенная для обмена сведениями между организациями или органами власти в рамках сеансов
обмена.

![Vvodnaya-Risunok1](https://github.com/Glay00/second_task_to-increase/assets/96641789/7fb39cc8-ae98-4fc8-8cdc-766deae4ef22)

#### В роли участников взаимодействия можно выделить следующих:

- Поставщики данных
- Потребители данных

---

Потребители данных могут получать сведения из других ИС путём отправки регламентированных запросов или пользуясь
подпиской
на изменение сведений.

---

Поставщики данных ПОДД СМЭВ осуществляют подключение к ПОДД СМЭВ, размещая актуальные данные, а также регистрируют
регламентированные завросы для получения данных Потребирелем.

---

Все запросы и ответы направляются в ПОДД СМЭВ от имени организаций
и подписываются электронными подмисями органов власти (ЭП-ОВ).


### Описать отличие СМЭВ 4 от СМЭВ 3

Актуальных СМЭВ два: СМЭВ3 и СМЭВ4.

СМЭВ 3, разработанная в 2009 году, на момент своего запуска привнесла революцию в систему государственного
взаимодействия.
Однако со временем стали появляться новые требования и возможности, необходимые для её совершенствования, что привело к
созданию более современной версии — СМЭВ 4.

При этом четвёртая версия не заменяет третью. Это две принципиально разные системы с
одним предназначением — организация обменов между системами участников взаимодействия. Разница в том, что:

#### СМЭВ3 подходит, когда нужно гарантированно передать информацию

![1cd2ba62b3cdbdeea03860d5c3b01e7a](https://github.com/Glay00/launching_SMEV4_adapter_in_docker/assets/96641789/16dfb23b-7917-4b22-b055-7bc71f367c45)

1. ИС Инициатора направляет запрос в СМЭВ;
2. СМЭВ размещает запрос в очереди ИС Ответчика;
3. ИС Ответчика извлекает запрос из своей очереди и подтверждает его получение;
4. ИС Ответчика готовит ответ и направляет его в СМЭВ;
5. СМЭВ размещает ответ в очереди ИС Инициатора;
6. ИС Инициатора извлекает ответ из своей очереди и подтверждает его получение.

#### СМЭВ4 — когда на первом месте стоит скорость обмена данными (см. рис для пункта 4)

Существует два варианта обмена в СМЭВ4:

- Обмен данными с использованием регламентированных запросов.

При обмене с использованием Регламентированных запросов взаимодействие происходит следующим образом:

1. Запрос от Информационной системы Потребителя передается Агенту ПОДД СМЭВ с использованием JDBC-драйвера или
   REST-интерфейса.
2. Агент отправляет запрос в Ядро ПОДД СМЭВ.
3. Ядро ПОДД СМЭВ после получения запроса выполняет его проверку и преобразование мнемоники запроса в SQL-выражение в
   соответствии с определением регламентированного запроса.
4. Ядро ПОДД СМЭВ направляет запрос через Агента ПОДД СМЭВ в адрес Витрины Поставщика.
5. Витрина Поставщика обрабатывает запрос и передает результат в Ядро ПОДД СМЭВ через Агент Поставщика.
6. Ядро ПОДД СМЭВ передает результат для исходного запроса Агенту Потребителя.
7. Агент Потребителя передает результат запроса Информационной системе с использованием JDBC-драйвера или
8. REST-интерфейса.

---

- Подписка Потребителя на Репликацию данных.
  
В режиме «по событию об изменении данных» подписка функционирует следующим образом.

1. Витрина уведомляет Агента ПОДД СМЭВ об изменении данных на Витрине Поставщика.
2. Агент ПОДД СМЭВ пересылает уведомление об изменении данных в Ядро ПОДД СМЭВ.
3. Ядро ПОДД СМЭВ получает уведомление и отправляет запрос дельты изменений Агенту Поставщика.
4. Агент Поставщика выгружает из Витрины дельту изменений и пересылает в Ядро ПОДД СМЭВ.
5. Ядро ПОДД СМЭВ пересылает дельту изменений в Хранилище данных по подписке через Агента Потребителя.
6. Хранилище данных по подписке выполняет проверку целостности полученных данных и применяет дельту изменений.
7. В режиме «по расписанию» Ядро ПОДД СМЭВ отправляет запросы о наличии дельты изменений Агенту Поставщика согласно
   расписанию, указанному в подписке.

---

## #TODO:

- побольше поработать с CryptoPro чтобы лучше ориентироваться в особенностях разработки
- администрирование сертификатов.
